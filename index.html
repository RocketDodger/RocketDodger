<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rocket Dodger</title>
<style>
  body {
    margin: 0;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    font-family: Arial, sans-serif;
    color: white;
  }
  #gameArea {
    position: relative;
    width: 300px;
    height: 500px;
    background: #111;
    overflow: hidden;
    border: 2px solid white;
  }
  #rocket {
    position: absolute;
    bottom: 20px;
    left: 130px;
    width: 40px;
    height: 60px;
    z-index: 2;
    background: url('rocket.png') no-repeat center center;
    background-size: contain;
  }
  /* removed hitbox visualization */
  #hitbox {
    position: absolute;
    top: 15px;
    left: 12px;
    width: 16px;
    height: 35px;
    background: transparent; 
    z-index: 3;
  }
  .asteroid {
    position: absolute;
    top: -50px;
    z-index: 2;
    background: url('asteroid.png') no-repeat center center;
    background-size: contain;
  }
  .star {
    position: absolute;
    width: 2px;
    height: 2px;
    background: white;
    border-radius: 50%;
    z-index: 1;
  }
  #scoreBoard {
    position: absolute;
    top: 5px;
    left: 5px;
    font-size: 16px;
    z-index: 4;
  }
  #gameOverMenu {
    position: absolute;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10;
    color: white;
    font-size: 18px;
    display: none;
  }
  #gameOverMenu button {
    padding: 10px 20px;
    margin-top: 10px;
    font-size: 18px;
    cursor: pointer;
  }
  .explosion {
    position: absolute;
    width: 80px;
    height: 80px;
    background: radial-gradient(circle, yellow 0%, orange 50%, red 100%);
    border-radius: 50%;
    pointer-events: none;
    z-index: 100;
    animation: explode 0.6s forwards;
  }
  @keyframes explode {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(3); opacity: 0; }
  }
  .particle {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    z-index: 101;
    opacity: 1;
  }
  .smoke {
    position: absolute;
    width: 8px;
    height: 8px;
    background: gray;
    border-radius: 50%;
    opacity: 0.7;
    z-index: 0;
  }
</style>
</head>
<body>
<div id="gameArea">
  <div id="rocket"><div id="hitbox"></div></div>
  <div id="scoreBoard">Score: 0 | Best: 0</div>
  <div id="gameOverMenu">
    <div id="finalScore"></div>
    <div id="personalBestDisplay"></div>
    <div id="highScoresDisplay"></div>
    <button onclick="restartGame()">Play Again</button>
  </div>
</div>

<script>
const rocket = document.getElementById('rocket');
const hitbox = document.getElementById('hitbox');
const gameArea = document.getElementById('gameArea');
const scoreBoard = document.getElementById('scoreBoard');
const gameOverMenu = document.getElementById('gameOverMenu');
const finalScoreDiv = document.getElementById('finalScore');
const personalBestDiv = document.getElementById('personalBestDisplay');
const highScoresDiv = document.getElementById('highScoresDisplay');

let rocketPos = 130;
let moveLeft = false;
let moveRight = false;
let asteroids = [];
let stars = [];
let smokeParticles = [];
let score = 0;
let speed = 2;
let gameOver = false;
let asteroidInterval;

let personalBest = localStorage.getItem('personalBest') || 0;
let highScores = JSON.parse(localStorage.getItem('highScores')) || [];

document.addEventListener('keydown', e => {
  if(e.key === 'ArrowLeft') moveLeft = true;
  if(e.key === 'ArrowRight') moveRight = true;
});
document.addEventListener('keyup', e => {
  if(e.key === 'ArrowLeft') moveLeft = false;
  if(e.key === 'ArrowRight') moveRight = false;
});

function moveRocket() {
  if(moveLeft && rocketPos > 0) rocketPos -= 5;
  if(moveRight && rocketPos < 260) rocketPos += 5;
  rocket.style.left = rocketPos + 'px';
  createSmoke();
}

function createAsteroid() {
  if(asteroids.length > 10) return; // cap number of asteroids
  const asteroid = document.createElement('div');
  asteroid.classList.add('asteroid');

  const type = Math.random();
  let size, speedMultiplier, points;

  if(type < 0.3){ // small
    size = 30;
    speedMultiplier = 1.5;
    points = 1;
  } else if(type < 0.7){ // medium
    size = 40;
    speedMultiplier = 1.2;
    points = 2;
  } else { // large
    size = 50;
    speedMultiplier = 1;
    points = 3;
  }

  asteroid.style.width = size + 'px';
  asteroid.style.height = size + 'px';
  asteroid.dataset.size = size;
  asteroid.dataset.speedMultiplier = speedMultiplier;
  asteroid.dataset.points = points;
  asteroid.style.left = Math.floor(Math.random() * (300 - size)) + 'px';
  asteroid.style.top = '-50px';
  asteroid.dataset.rotation = 0;
  asteroid.dataset.rotSpeed = (Math.random()*4-2); // rotation
  gameArea.appendChild(asteroid);
  asteroids.push(asteroid);
}

function moveAsteroids() {
  const padding = 2;
  asteroids.forEach((asteroid, index) => {
    let top = parseInt(asteroid.style.top);
    top += speed * parseFloat(asteroid.dataset.speedMultiplier);
    asteroid.style.top = top + 'px';

    // Rotate asteroid
    let rotation = parseFloat(asteroid.dataset.rotation);
    rotation += parseFloat(asteroid.dataset.rotSpeed);
    asteroid.style.transform = `rotate(${rotation}deg)`;
    asteroid.dataset.rotation = rotation;

    const rocketRect = hitbox.getBoundingClientRect();
    const astRect = asteroid.getBoundingClientRect();
    if(!(rocketRect.right-padding<astRect.left+padding ||
         rocketRect.left+padding>astRect.right-padding ||
         rocketRect.bottom-padding<astRect.top+padding ||
         rocketRect.top-padding>astRect.bottom-padding)) {
      triggerExplosion();
    }

    if(top > 500) {
      asteroid.remove();
      asteroids.splice(index, 1);
      score += parseInt(asteroid.dataset.points);
      scoreBoard.textContent = `Score: ${score} | Best: ${personalBest}`;
      if(score > personalBest) personalBest = score;
      adjustDifficulty();
    }
  });
}

// Parallax stars
for(let i=0;i<50;i++){
  const star = document.createElement('div');
  star.classList.add('star');
  star.style.left = Math.random() * 300 + 'px';
  star.style.top = Math.random() * 500 + 'px';
  star.dataset.speed = Math.random() * 2 + 0.5;
  gameArea.appendChild(star);
  stars.push(star);
}

function moveStars() {
  stars.forEach(star => {
    let top = parseFloat(star.style.top);
    top += parseFloat(star.dataset.speed);
    if(top > 500) top = 0;
    star.style.top = top + 'px';
  });
}

function createSmoke() {
  const s = document.createElement('div');
  s.classList.add('smoke');
  s.style.left = rocketPos + 16 + 'px';
  s.style.top = 70 + 'px';
  gameArea.appendChild(s);
  smokeParticles.push(s);

  setTimeout(()=> {
    s.remove();
    smokeParticles.splice(smokeParticles.indexOf(s),1);
  },500);
}

function triggerExplosion() {
  if(gameOver) return;
  gameOver = true;

  const rocketRect = rocket.getBoundingClientRect();
  const gameRect = gameArea.getBoundingClientRect();
  const x = rocketRect.left - gameRect.left + rocketRect.width/2;
  const y = rocketRect.top - gameRect.top + rocketRect.height/2;

  const explosion = document.createElement('div');
  explosion.classList.add('explosion');
  explosion.style.left = (x-40)+'px';
  explosion.style.top = (y-40)+'px';
  gameArea.appendChild(explosion);

  for(let i=0;i<40;i++){
    const p = document.createElement('div');
    p.classList.add('particle');
    const size = Math.random()*5 + 3;
    p.style.width = size+'px';
    p.style.height = size+'px';
    p.style.left = x+'px';
    p.style.top = y+'px';
    p.style.background = ['orange','yellow','red'][Math.floor(Math.random()*3)];
    gameArea.appendChild(p);

    const angle = Math.random()*2*Math.PI;
    const speed = Math.random()*5 + 2;
    const dx = Math.cos(angle)*speed;
    const dy = Math.sin(angle)*speed;
    let t = 0;

    const interval = setInterval(()=>{
      t+=0.02;
      p.style.left = x + dx*t*15 +'px';
      p.style.top = y + dy*t*15 +'px';
      p.style.opacity = 1 - t*2;
      if(t>0.5){ clearInterval(interval); p.remove(); }
    },16);
  }

  setTimeout(()=>{ rocket.style.display='none'; }, 100);

  setTimeout(()=>{ explosion.remove(); endGame(); }, 800);
}

// Difficulty scaling
function adjustDifficulty() {
  if(score % 10 === 0 && score !== 0){
    speed += 0.5;
    clearInterval(asteroidInterval);
    let intervalTime = Math.max(300, 1000 - score*10);
    asteroidInterval = setInterval(createAsteroid, intervalTime);
  }
}

function endGame() {
  clearInterval(asteroidInterval);
  localStorage.setItem('personalBest', personalBest);
  highScores.push(score);
  highScores.sort((a,b)=>b-a);
  highScores = highScores.slice(0,5);
  localStorage.setItem('highScores', JSON.stringify(highScores));
  finalScoreDiv.textContent = `Your Score: ${score}`;
  personalBestDiv.textContent = `Personal Best: ${personalBest}`;
  highScoresDiv.innerHTML = "High Scores:<br>" + highScores.map((s,i)=>`${i+1}. ${s}`).join('<br>');
  gameOverMenu.style.display='flex';
}

function restartGame() {
  asteroids.forEach(a => a.remove());
  asteroids = [];
  rocket.style.display='block';
  score = 0;
  scoreBoard.textContent = `Score: 0 | Best: ${personalBest}`; // reset score right away
  speed = 2;
  rocketPos = 130;
  rocket.style.left = rocketPos + 'px';
  gameOver = false;
  gameOverMenu.style.display='none';
  startGame();
}

function gameLoop() {
  if(!gameOver){
    moveRocket();
    moveAsteroids();
    moveStars();
    requestAnimationFrame(gameLoop);
  }
}

function startGame() {
  asteroidInterval = setInterval(createAsteroid, 1000);
  gameLoop();
}

// Pause asteroids when tab not visible
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    clearInterval(asteroidInterval);
  } else {
    if(!gameOver){
      asteroidInterval = setInterval(createAsteroid, 1000);
    }
  }
});

startGame();
</script>
</body>
</html>
